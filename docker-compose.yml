version: '3.8'

services:
  vaultsec:
    build:
      context: .
      dockerfile: Dockerfile.server
    container_name: vaultsec-server
    # ports not needed with network_mode: host
    env_file:
      - .env
    volumes:
      - ./strix_runs:/app/strix_runs  # Persist scan results
      - ./agent_runs:/app/agent_runs  # Persist agent runs
      - ./data:/app/data  # Persist SQLite database
      - /var/run/docker.sock:/var/run/docker.sock  # Allow container to spawn sandbox containers
    network_mode: host  # Use host network so container can reach sandbox containers
    restart: unless-stopped
